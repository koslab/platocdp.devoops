<?xml version="1.0" encoding="UTF-8"?>
<!--start main rule, only theme if #visual-portal-wrapper exist -->
<rules
    xmlns="http://namespaces.plone.org/diazo"
    xmlns:css="http://namespaces.plone.org/diazo/css"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    css:if-content="#visual-portal-wrapper">

    <rules css:if-content="#visual-portal-wrapper">
        <theme href="index.html"/>
        <!--HEAD SECTION-->
        <!-- Drop styles in the head - these are added back by including them from Plone -->
        <!-- <drop theme="/html/head/style | /html/head/script | /html/head/link | /html/head/title" />-->
        <prepend theme="/html/head" content="/html/head/base | /html/head/link | /html/head/style | /html/head/script | /html/head/meta | /html/head/title" />
        <replace theme="/html" content="/html" attributes="lang"/>
        <merge theme="/html/body" content="/html/body" attributes="class"/>
        <merge theme="/html/body" content="/html/body" attributes="dir"/>
        <append css:theme="body" css:content="#plone-analytics"/>

        <replace css:theme="#portal-logo"
            css:content="#portal-logo"/>

        <!-- [LeftNavigationMenu] -->

        <replace css:theme-children=".main-menu">
            <xsl:for-each css:select="#navigation > li">
                <li>
                    <a><xsl:attribute name="class">
                            <xsl:value-of select="a/@class"/>
                            <xsl:if test="contains(current()/@class, 'active')">
                                active
                            </xsl:if>
                    </xsl:attribute><xsl:attribute name="href">
                    <xsl:value-of select="a/@href"/>
                    </xsl:attribute>
                <i class="fa fa-folder"></i>
                <xsl:copy-of select="a/text()"/>
                </a>
                </li>
            </xsl:for-each>
        </replace>

        <!-- [/LeftNavigationMenu] -->


        <!-- [ActionButtons] -->

        <drop css:theme="#platocdp-contentmenu-edit" css:if-not-content="#edit-content-views"/>
        <replace css:theme-children="#platocdp-contentmenu-edit > .dropdown-menu"
            css:content-children="#edit-content-views"/>


        <drop css:theme="#platocdp-contentmenu-actions" css:if-not-content="#plone-contentmenu-actions"/>
        <replace css:theme-children="#platocdp-contentmenu-actions > .dropdown-menu"
            css:content-children="#plone-contentmenu-actions > ul"/>

        <drop css:theme="#platocdp-contentmenu-display" css:if-not-content="#plone-contentmenu-display"/>
        <replace css:theme-children="#platocdp-contentmenu-display > .dropdown-menu"
            css:content-children="#plone-contentmenu-display > ul"/>

        <drop css:theme="#platocdp-contentmenu-factories" css:if-not-content="#plone-contentmenu-factories"/>
        <replace css:theme-children="#platocdp-contentmenu-factories > .dropdown-menu">
            <xsl:for-each css:select="#plone-contentmenu-factories > ul > li">
                <li><a><xsl:attribute name="id"><xsl:value-of select="a/@id"/></xsl:attribute><xsl:attribute name="title"><xsl:value-of select="a/@title"/></xsl:attribute><xsl:attribute name="href"><xsl:value-of select="a/@href"/></xsl:attribute>
                <xsl:copy-of select="a/node()"/>
                </a></li>
            </xsl:for-each>
        </replace>

        <drop css:theme="#platocdp-contentmenu-workflow" css:if-not-content="#plone-contentmenu-workflow"/>
        <replace css:theme-children="#platocdp-contentmenu-workflow > .dropdown-menu"
            css:content-children="#plone-contentmenu-workflow > ul"/>
        <replace css:theme-children="#platocdp-contentmenu-workflow .badge" 
            css:content-children="#plone-contentmenu-workflow > button > span:nth-child(2)"/>

        <!-- [/ActionButtons] -->


        <!-- [MainContent] -->
        <replace css:theme-children=".breadcrumb" css:content-children=".breadcrumb"/>

        <rules css:if-content=".portaltype-portlet-page.template-two-columns">
            <drop css:theme="#content-well" attributes="class"/>
            <replace css:theme-children="#content-well">

            <h3 class="page-header"><xsl:copy-of select="//*[@id='parent-fieldname-title']/node()"/></h3>
            <xsl:if css:test="#portletPageTopRow">
            <div class="row" id="platocdp-portletpage-top">
                <div class="col-xs-12">
                    <xsl:for-each css:select="#portletPageTopRow .portletWrapper">
                        <xi:include href="portlet-rules.xml"/>
                    </xsl:for-each>
                </div>
            </div>
            </xsl:if>

            <div class="row" id="platocdp-portletpage-columns">
                <div class="col-sm-12 col-md-6">
                    <xsl:if css:test="#portletPageFirstColumn">
                        <xsl:for-each css:select="#portletPageFirstColumn .portletWrapper">
                            <xi:include href="portlet-rules.xml"/>
                        </xsl:for-each>
                    </xsl:if>
                </div>
                <div class="col-sm-12 col-md-6">
                    <xsl:if css:test="#portletPageSecondColumn">
                        <xsl:for-each css:select="#portletPageSecondColumn .portletWrapper">
                            <xi:include href="portlet-rules.xml"/>
                        </xsl:for-each>
                    </xsl:if>
                </div>
            </div>

            <xsl:if css:test="#portletPageBottomRow">
            <div class="row" id="platocdp-portletpage-bottom">
                <div class="col-xs-12">
                    <xsl:for-each css:select="#portletPageBottomRow .portletWrapper">
                        <xi:include href="portlet-rules.xml"/>
                    </xsl:for-each>
                </div>
            </div>
            </xsl:if>

            </replace>
        </rules>

        <rules css:if-not-content=".portaltype-portlet-page.template-two-columns">
            <prepend css:theme="#content-well" css:content-children="#content"/>
        </rules>

        <!-- [/MainContent] -->
    </rules>
</rules>
